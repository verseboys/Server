{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="{% static 'images/20171213113454.png' %}">
    <title>医咖会-邮箱忘记密码</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            background-color: #f9f9f9;
        }

        a {
            text-decoration: none;
        }

        input:focus {
            box-sizing: border-box;
            outline: none;
        }

        ::placeholder {
            color: #b3bac6;
            font-weight: 300;
        }

        * div {
            font-weight: 300;
        }
        /* pc */
        @media only screen
        and (min-device-width : 768px) {
            .login-box {
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100%;
                min-height: 440px;
                min-width: 500px;
                background: url({% static 'images/yika_bg.jpg' %}) no-repeat top;
                background-size: cover;
            }
            .login-box .front-register {
                width: 376px;
                height: 341px;
                padding: 40px;
                background: #fff;
                border-radius: 4px;
                box-shadow: 0 2px 13px 5px rgba(69, 160, 234, 0.17);
            }
            .logo-text {
                margin-bottom: 32px;
                font-family: PingFang SC, Hiragino Sans GB, Helvetica Neue, Helvetica, Microsoft YaHei, Noto Sans CJK SC, WenQuanYi Micro Hei, Arial, sans-serif;
                font-size: 30px;
                text-align: center;
                color: #403f40;
                font-weight: 400;
                margin-top:20px;
            }
            .shadow_btn {
                display: inline-block;
                color: #fff;
                font-size: 16px;
                width: 84px;
                height: 100%;
                text-align: center;
                background-color: #33A466;
                border-radius: 2px;
                cursor: pointer;
            }
            .shadow_btn:hover {
                background-image: linear-gradient(rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05));
            }
            .regist_login {
                display: inline-block;
                color: #403f40;
                font-size: 14px;
                padding-right: 10px;
                cursor: pointer;
                margin-left: 19px;
            }
            .regist_login a {
                color: #403f40;
            }
            .input_item {
                display: flex;
                position: relative;
                background-color: #F5F9FF;
                border-radius: 2px;
                align-items: center;
                margin-top: 20px;
            }
            .neko_input {
                flex: 1;
                background-color: #F5F9FF;
                color: #333;
                height: 48px;
                font-size: 14px;
                padding-left: 25px;
                box-sizing: border-box;
                display: inline-block;
                vertical-align: top;
                border: none;
            }
            .input_item .defule {
                color: #999;
            }
            .verify {
                position: absolute;
                right: 0;
                height: 48px;
                cursor: pointer;
                background: #fff;
            }
            .error_tip {
                width: 377px;
                height: 26px;
            } 
            .error_tip .error-tip {
                line-height: 26px;
                background-color: #e46d7c;
                text-align: center;
                color: #fff;
                font-size: 14px;
            }
            .regist_submit {
                display: block;
                width: 376px;
                line-height: 46px;
                border-radius: 2px;
                background-color: #45a0ea;
                color: #fff;
                text-align: center;
            }
            .email_active_inform {
                width: 456px;
                height: 389px;
                border-radius: 4px;
                box-shadow: 0 2px 13px 5px rgba(69, 160, 234, 0.17);
                background-color: #fff;
            }
            .email_active_inform .logo-text {
                margin-bottom: 0;
                margin-top: 40px;
            }
            .email_active_inform>p {
                margin: 0 auto;
                padding: 50px 90px;
                color: #666;
                font-size: 15px;
                line-height: 24px;
            }
            .email_active_inform>a {
                display: block;
                width: 379px;
                line-height: 46px;
                border-radius: 2px;
                background-color: #03a675;
                color: #fff;
                text-align: center;
                margin: 0 auto;
            }
        }
        /* 移动端 */
        @media only screen
        and (max-device-width : 768px) {
            .login-box {
                width: 100%;
                height: 100%;
                background: #fff;
            }
            .login-box .front-register {
                width: 82%;
                top: 50%;
                left: 50%;
                position: absolute;
                transform: translate(-50%, -50%);
            }
            .logo-text {
                margin-bottom: 32px;
                font-family: PingFang SC, Hiragino Sans GB, Helvetica Neue, Helvetica, Microsoft YaHei, Noto Sans CJK SC, WenQuanYi Micro Hei, Arial, sans-serif;
                font-size: 28px;
                text-align: center;
                color: #403f40;
                font-weight: 400;
            }
            .shadow_btn {
                display: inline-block;
                color: #fff;
                font-size: 16px;
                width: 84px;
                height: 100%;
                text-align: center;
                background-color: #33A466;
                border-radius: 2px;
                cursor: pointer;
            }
            .shadow_btn:hover {
                background-image: linear-gradient(rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.05));
            }
            .regist_login {
                display: inline-block;
                color: #403f40;
                font-size: 14px;
                padding-right: 10px;
                cursor: pointer;
                margin-left: 19px;
            }
            .regist_login a {
                color: #403f40;
            }
            .input_item {
                display: flex;
                position: relative;
                background-color: #F5F9FF;
                border-radius: 2px;
                align-items: center;
                margin-top: 15px;
            }
            .neko_input {
                flex: 1;
                background-color: #F5F9FF;
                color: #333;
                height: 45px;
                font-size: 14px;
                padding-left: 25px;
                box-sizing: border-box;
                display: inline-block;
                vertical-align: top;
                border: none;
            }
            .input_item .defule {
                color: #999;
            }
            .verify {
                position: absolute;
                right: 0;
                height: 45px;
                cursor: pointer;
                background: #fff;
            }
            .regist_submit {
                display: block;
                width: 100%;
                line-height: 40px;
                border-radius: 2px;
                background-color: #45a0ea;
                color: #fff;
                text-align: center;
            }
            .error_tip {
                width: 100%;
                height: 26px;
            }
            .error_tip .error-tip {
                line-height: 26px;
                font-size: 14px;
            }
            .email_active_inform {
                width: 100%;
                position: absolute;
                left: 55%;
                top: 50%;
                margin-left: -228px;
                margin-top: -195px;
            }
            .email_active_inform .logo-text {
                margin-bottom: 0;
                margin-top: 0;
            }
            .email_active_inform>p {
                margin: 0 auto;
                padding: 40px 53px;
                color: #666;
                font-size: 15px;
                line-height: 24px;
                text-align:center;
            }
            .email_active_inform>a {
                display: block;
                width: 84%;
                line-height: 40px;
                border-radius: 2px;
                background-color: #03a675;
                color: #fff;
                text-align: center;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
<div class="login-box">
    <div class="front-register" style="position: relative;">
        <div class="logo-text" style="margin-bottom:0;">忘记密码</div>
        <div class="error_tip">
            <div class="error-tip" style="background-color: #e46d7c;text-align: center;color: #fff;display: none;">邮箱不能为空</div>
        </div>
        <div class="input_item" style="margin-top: 4px;">
            <input placeholder="请输入注册使用的邮箱" type="email" class="neko_input usr_email">
        </div>
        <div class="" style="position: relative;display: flex;">
            <div class="input_item" style="flex: 1;margin-right: 115px;">
                <input placeholder="填写验证码" class="neko_input usr_cap">
            </div>
            <div class="input_item verify">
                <img src="">
            </div>
        </div>
        <div class="input_item">
            <a href="javascript:;" class="regist_submit">发送找回链接</a>
        </div>
        <div style="display: flex;justify-content: space-between;padding-top: 20px;font-size: 14px;">
            <a href="{% url 'phone_forget_pwd' %}" style="color: #45a0ea;">手机找回</a>
            <a href="{% url 'front_login' %}#1" style="color: #45a0ea;">返回登录</a>
        </div>
    </div>
    <div class="email_active_inform" style="display:none;">
        <div class="logo-text">邮箱验证</div>
        <p>验证邮件已经发送，请在30min内点击邮件中的链接完成密码修改。</p>
        <a href="/">确认</a>
        <div style="display: flex;justify-content: space-between;padding: 0 40px;padding-top: 23px;">
            <span style="font-size: 13px;color: #b2b2b2;">没有收到邮件，怎么办？在邮箱的垃圾邮件中找找</span>
        </div>
    </div>
</div>
<script src="https://lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        img_captcha()
        var ary_type={}
        var ary_click_defult = [
            {
                name: '.usr_email', // 邮箱
                type:'email'
            }, {
                name: '.usr_cap', // 验证码
                type:'cap'
            },
        ]
        // var uPattern = /[\u4E00-\u9FA5a-zA-Z0-9_-]{2,16}/; // 用户名正则表达式
        var ePattern = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/; // 邮箱正则表达式
        // 失去焦点
        $(".usr_email").blur(function(){
            if ($('.usr_email').val() != '' && !ePattern.test($('.usr_email').val())) {
                $('.error-tip').html('邮箱格式错误')
                $('.error-tip').fadeIn(1000)
            } else {
                $('.error-tip').fadeOut(1000)
            }
        })
        $(document).on('click','.regist_submit', function () {
            // 邮箱校验
            if ($('.usr_email').val()==='') {
                $('.error-tip').html('邮箱不能为空')
                $('.error-tip').fadeIn(1000);
                return false;
            } else if (!ePattern.test($('.usr_email').val())) {
                $('.error-tip').html('邮箱格式错误');
                $('.error-tip').fadeIn(1000);
                return false;
            }
            // 验证码校验
            if ($('.usr_cap').val() === '') {
                $('.error-tip').html('验证码不能为空');
                $('.error-tip').fadeIn(1000);
                return false;
            }
            if($('.usr_email').val() && $('.usr_cap').val()){
                $.ajax({
                    type: 'post',
                    url: '/forget_password/',
                    data: {
                        email: $('.usr_email').val(),
                        captcha: $('.usr_cap').val(),
                    },
                    success: function (data) {
                        if (data.code === 200) {
                            //成功
                            $('.front-register').hide();
                            $('.email_active_inform').show();
                        } else {
                            //失败
                            img_captcha()
                            $('.error-tip').html(data.message)
                            $('.error-tip').fadeIn(1000)
                        }
                    }
                })
            }
        })

        // 验证码
        $(document).on('click','.verify',function () {
            img_captcha()
        })
        function img_captcha() {
            var num=Math.random()
            $('.verify img').attr('src','/extends/captcha/?='+ num)
        }
        // 点击激活邮箱
        $(document).on('click','.activate',function() {
            var activate_email = $('.usr_email').val();
            var url = activate_email.split('@')[1];
            var pattern = /^([A-Za-z0-9_\-\.])+\@(163.com|qq.com)$/; // 判断邮箱为163.com 或 qq.com
            if (pattern.test(activate_email) === true){
                if (url == '163.com') {
                    window.location.href = 'http://mail.163.com';
                } else if (url == 'qq.com') {
                    window.location.href = 'http://mail.qq.com';
                }
            } else {
                // 其他邮箱@后面的跳转baidu查询
                window.location.href = 'https://www.baidu.com/'+ 's?wd=mail.'+ url;
            }
        })
    })
</script>
</body>
</html>