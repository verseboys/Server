{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>医咖会—找回密码</title>
    <link rel="shortcut icon" href="{% static 'images/20171213113454.png' %}">
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        html, body {
            height: 100%;
            background-color: #f9f9f9;
        }
        a {
            text-decoration: none;
        }
        input:focus {
            box-sizing: border-box;
            outline: none;
        }
        ::placeholder {
            color: #b3bac6;
            font-weight: 300;
        }
        * div {
            font-weight: 300;
        }
        /* pc */
        @media only screen
        and (min-device-width : 768px) {
            .login-box {
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100%;
                min-height: 440px;
                min-width: 500px;
                background: url({% static 'images/yika_bg.jpg' %}) no-repeat top;
                background-size: cover;
            }
            .login-box .register_phone {
                width: 376px;
                height: 320px;
                padding: 40px;
                background: #fff;
                border-radius: 4px;
                box-shadow: 0 2px 13px 5px rgba(69, 160, 234, 0.17);
            }
            .logo-text {
                margin-bottom: 32px;
                font-family: PingFang SC, Hiragino Sans GB, Helvetica Neue, Helvetica, Microsoft YaHei, Noto Sans CJK SC, WenQuanYi Micro Hei, Arial, sans-serif;
                font-size: 30px;
                text-align: center;
                color: #403f40;
                font-weight: 400;
                margin-top:20px;
                margin-bottom:0;
            }
            .regist_login {
                display: inline-block;
                color: #403f40;
                font-size: 14px;
                padding-right: 10px;
                cursor: pointer;
                margin-left: 19px;
            }
            .regist_login a {
                color: #403f40;
            }
            .input_item {
                display: flex;
                position: relative;
                background-color: #F5F9FF;
                border-radius: 2px;
                align-items: center;
                margin-top: 20px;
            }
            .neko_input {
                flex: 1;
                background-color: #F5F9FF;
                color: #333;
                height: 48px;
                font-size: 14px;
                padding-left: 25px;
                box-sizing: border-box;
                display: inline-block;
                vertical-align: top;
                border: none;
            }
            .verify {
                position: absolute;
                right: 0;
                height: 48px;
                cursor: pointer;
                padding: 0 15px;
                border-radius: 4px;
                background-color: #45a0ea;
            }
            .verify button {
                border: none;
                background: none;
                color: #fff;
                font-size: 14px;
                outline:none;
            }
            .regist_submit {
                display: block;
                width: 376px;
                line-height: 46px;
                border-radius: 2px;
                background-color: #45a0ea;
                color: #fff;
                text-align: center;
            }
            .error_tip {
                width: 377px;
                height: 26px;
            } 
            .error_tip .error-tip {
                line-height: 26px;
                background-color: #e46d7c;
                text-align: center;
                color: #fff;
                font-size: 14px;
            }
            .register_phone .message {
                text-align: center;
                font-size: 18px;
                line-height: 28px;
                color: #4a4a4a;
                padding-top: 12px;
            }
            .register_phone .status {
                padding-top: 70px;
            }
            .register_phone .return_home {
                width: 379px;
                height: 46px;
                border-radius: 2px;
                background-color: #03a675;
                line-height:46px;
                color: white;
                font-size: 18px;
                text-decoration:none;
                text-align: center;
                display: inline-block;
                margin-top:54px;
            }
        }
        /*移动端 */
        @media only screen
        and (max-device-width : 768px) {
            .login-box {
                width: 100%;
                height: 100%;
                background: #fff;
            }
            .login-box .register_phone {
                width: 82%;
                top: 50%;
                left: 50%;
                position: absolute;
                transform: translate(-50%, -50%);
            }
            .logo-text {
                margin-bottom: 32px;
                font-family: PingFang SC, Hiragino Sans GB, Helvetica Neue, Helvetica, Microsoft YaHei, Noto Sans CJK SC, WenQuanYi Micro Hei, Arial, sans-serif;
                font-size: 28px;
                text-align: center;
                color: #403f40;
                font-weight: 400;
                margin-top: 0;
            }
            .regist_login {
                display: inline-block;
                color: #403f40;
                font-size: 14px;
                padding-right: 10px;
                cursor: pointer;
                margin-left: 19px;
            }
            .regist_login a {
                color: #403f40;
            }
            .input_item {
                display: flex;
                position: relative;
                background-color: #F5F9FF;
                border-radius: 2px;
                align-items: center;
                margin-top: 15px;
            }
            .neko_input {
                flex: 1;
                background-color: #F5F9FF;
                color: #333;
                height: 45px;
                font-size: 14px;
                padding-left: 25px;
                box-sizing: border-box;
                display: inline-block;
                vertical-align: top;
                border: none;
            }
            .verify {
                position: absolute;
                right: 0;
                height: 45px;
                cursor: pointer;
                padding: 0 15px;
                border-radius: 4px;
                background-color: #45a0ea;
            }
            .verify button {
                border: none;
                background: none;
                color: #fff;
                font-size: 14px;
                outline:none;
                cursor: pointer;
            }
            .regist_submit {
                display: block;
                width: 100%;
                line-height: 40px;
                border-radius: 2px;
                background-color: #45a0ea;
                color: #fff;
                text-align: center;
            }
            .error_tip {
                width: 100%;
                height: 26px;
            }
            .error_tip .error-tip {
                line-height: 26px;
                font-size: 14px;
            }
            .register_phone .message {
                text-align: center;
                font-size: 16px;
                line-height: 28px;
                color: #4a4a4a;
                padding-top: 12px;
            }
            .register_phone .status {
                padding-top: 0;
            }
            .register_phone .return_home {
                width: 100%;
                height: 40px;
                border-radius: 2px;
                background-color: #03a675;
                line-height:40px;
                color: white;
                font-size: 16px;
                text-decoration:none;
                text-align: center;
                display: inline-block;
                margin-top:45px;
            }
        }
    </style>
</head>
<body>
<div class="login-box">
    <div class="register_phone" style="position: relative;">
        {% if message %}
        <div class="link-broken">
            <div class="status" style="text-align: center;">
                <svg width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g id="登录注册页面手机注册改版" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g id="邮箱注册4-失败" transform="translate(-666.000000, -311.000000)">
                        <g id="失败" transform="translate(666.000000, 311.000000)">
                            <path d="M0,32 C6.97413142e-15,49.673112 14.326888,64 32,64 C49.673112,64 64,49.673112 64,32 C64,14.326888 49.673112,0 32,0 C14.326888,-2.32471047e-15 6.97413142e-15,14.326888 0,32 Z" id="路径" fill="#FF5700"></path>
                            <path d="M30.353769,48.1247591 C30.353769,49.0550086 30.6628836,49.9849684 31.1991791,50.6474057 C31.7354745,51.3098429 32.4778463,51.6923077 33.2413223,51.6923077 C33.9942463,51.6923077 34.7471702,51.3101324 35.2834655,50.6474057 C35.819761,49.9849684 36.1288756,49.0677477 36.1288756,48.1247591 C36.1288756,47.1947991 35.819761,46.2645497 35.2834655,45.6021125 C34.7471701,44.9396753 34.0047983,44.5575 33.2413223,44.5575 C32.4883983,44.5575 31.7354744,44.9396753 31.1991791,45.6021125 C30.6628836,46.2772889 30.353769,47.1947991 30.353769,48.1247591 Z M36.9230769,15.7519046 C36.9230769,13.8468186 35.2729134,12.3076944 33.2307702,12.3076944 C32.2512351,12.3066943 31.3115065,12.669235 30.618841,13.3153583 C29.9261756,13.9614816 29.5374737,14.8381103 29.5384634,15.7519046 C29.5384634,15.8193643 29.5384634,15.8865345 29.5490156,15.9539943 L30.3534586,37.8998324 C30.3534586,39.3813408 31.6426779,40.5837454 33.2304598,40.5837454 C34.8188624,40.5837454 36.1080817,39.3813408 36.1080818,37.8998324 L36.9125248,15.9539943 C36.9125248,15.8865346 36.9230769,15.8193644 36.9230769,15.7519046 Z" id="形状" fill="#FFFFFF" fill-rule="nonzero"></path>
                        </g>
                    </g>
                </g>
                </svg>
            </div>
            <div class="message">
                <div style="padding: 0 75px;">{{message}}</div>
            </div>
            <a href="/" class="return_home">返回首页</a>
        </div>
        {% else %}
        <div class="recover-password">
            <div class="logo-text">找回密码</div>
            <div class="error_tip">
                <div class="error-tip" style="background-color: #e46d7c;text-align: center;color: #fff;display: none;"></div>
            </div>
            <div class="input_item" style="margin-top: 4px;">
                <input placeholder="请输入新密码" type="password" class="neko_input usr_pass">
            </div>
            <div class="input_item">
                <input placeholder="再次输入密码" type="password" class="neko_input usr_repass">
            </div>
            <div style="margin-top: 20px;">
                <a href="javascript:;" class="regist_submit">确认修改</a>
            </div>
            <div style="display: flex;justify-content: flex-end;padding-top: 20px;font-size: 14px;">
                <a href="{% url 'front_login' %}#1" style="color: #45a0ea;">返回登录</a>
            </div>
        <div>
        {% endif %}
    </div>
</div>
<script src="https://lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        var ary_type={}
        var ary_click_defult = [
            {
                name: '.usr_pass', // 验证码
                type:'pass'
            }, {
                name: '.usr_repass',  // 密码
                type:'repass'
            },
        ]
        var telPattern = /^[1]([3-9])[0-9]{9}$/; // 手机号匹配正则
        $(document).on('click', '.regist_submit', function () {
            if ($('.usr_pass').val() ==='') {
                $('.error-tip').html('密码不能为空');
                $('.error-tip').fadeIn(1000);
                return false;
            }
            if(!$('.usr_pass').val()){
                $('.error-tip').html('请输入密码');
                $('.error-tip').fadeIn(1000);
                return false;
            }else if(!($('.usr_pass').val().length>=4 && $('.usr_pass').val().length<=16)){
                $('.error-tip').html('请输入4-16位长度密码');
                $('.error-tip').fadeIn(1000);
                return false;
            }
            if(!$('.usr_repass').val()){
                $('.error-tip').html('请再次输入密码');
                $('.error-tip').fadeIn(1000);
                return false;
            }else if(!($('.usr_repass').val().length>=4 && $('.usr_repass').val().length<=16)){
                $('.error-tip').html('请输入4-16位长度密码')
                $('.error-tip').fadeIn(1000)
                return false;
            }else if($('.usr_repass').val()!==$('.usr_pass').val()){
                $('.error-tip').html('两次输入密码不一致')
                $('.error-tip').fadeIn(1000)
                return false;
            }
            
            if($('.usr_pass').val() && $('.usr_repass').val()){
                var s= window.location.pathname.replace('/recover_password','')
                $.ajax({
                    type: 'post',
                    url: '/recover_password'+s,// TODO 接口需要改
                    data: {
                        password: $('.usr_pass').val(),
                        repeat_password: $('.usr_repass').val(),
                    },
                    success: function (data) {
                        if (data.code === 200) {
                            //成功 密码修改成功提示
                            $('.link-broken').hide();
                            $('.recover-password').hide();
                            var recover_password = `<div style="text-align: center;" class="status">
                                    <svg width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <g id="登录注册页面手机注册改版" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <g id="邮箱注册3-成功" transform="translate(-656.000000, -315.000000)">
                                                <g id="成功" transform="translate(656.000000, 315.000000)">
                                                    <path d="M0,32 C0,49.7 14.3,64 32,64 C49.7,64 64,49.7 64,32 C64,14.3 49.7,0 32,0 C14.3,0 0,14.3 0,32 Z" id="路径" fill="#46B229"></path>
                                                    <path d="M50.1745633,19.4318156 C49.2696245,18.7738109 47.8619419,18.8678115 47.1581006,19.7138176 L29.8637146,39.735962 L19.6077414,29.9598915 C18.8033514,29.2078861 17.4962176,29.2078861 16.6918275,29.9598915 C15.7868887,30.711897 15.7868887,31.9339058 16.5912788,32.7799119 L27.5510932,43.3079878 C27.5510932,43.3079878 28.5565807,44.3419953 28.7576782,44.5299966 C29.1598733,44.8119986 29.5620683,45 30.0648121,45 L30.2659096,45 C30.7686534,45 31.2713972,44.8119986 31.5730434,44.4359959 C31.7741409,44.2479946 32.7796285,42.9319851 32.7796285,42.9319851 L50.5767583,22.3458366 C51.2805996,21.3118292 51.0795021,20.0898204 50.1745633,19.4318156 Z" id="路径" fill="#FFFFFF"></path>
                                                </g>
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                                <div class="message">
                                    <div style="padding: 0 75px;">${data.message}</div>
                                </div>
                                <a href="/" class="return_home">返回首页</a>`
                            $('.register_phone').append(recover_password);
                        } else {
                            //失败
                            $('.error-tip').html(data.message)
                            $('.error-tip').fadeIn(1000)
                        }
                    }
                })
            }
        })
    })
</script>
</body>
</html>
